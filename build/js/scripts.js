"use strict";define("InstagramCollection",["backbone","ItemModelInstagram","EventMediator","ItemCollection"],function(Backbone,ItemModelInstagram,EventMediator,ItemCollection){return ItemCollection.extend({model:ItemModelInstagram,url:"/api/instagram",initialize:function(models,options){this.attributeSet({bounds:options.bounds,timeout:!1,scrollTo:void 0,clusters:[],allModels:{},params:{lat:options.bounds.center.lat,lng:options.bounds.center.lng},settings:{hide:!1,pause:!1}}),this.fetchData(this.attributeGet("params"))},mapBoundsChange:function(data){this.attributeSet({bounds:data.bounds,clusters:data.clusters});const query={lat:data.bounds.center.lat,lng:data.bounds.center.lng},params=this.attributeGet("params");Math.abs(query.lat-params.lat)<1e-4&&Math.abs(query.lng-params.lng)<1e-4||ItemCollection.prototype.mapBoundsChange.apply(this,[query])},clear:function(){ItemCollection.prototype.clear.apply(this),EventMediator.emit("instagram-cleared",null)}})}),define("ItemCollection",["backbone","underscore","EventMediator"],function(Backbone,_,EventMediator){var ItemCollection=Backbone.Collection.extend({setSettings:function(settings){settings=Object.assign(this.attributeGet("settings"),settings),this.attributeSet("settings",settings),!0!==settings.hide&&!0!==settings.pause||this.forceHide()},clear:function(){this.attributeSet({scrollTo:void 0,allModels:{},clusters:[]}),this.each(model=>{model.hide()})},forceHide:function(){const allModels=this.attributeGet("allModels");Object.keys(allModels).forEach(id=>{allModels[id].hide()})},updateViews:function(){const settings=this.attributeGet("settings");if(!0===settings.hide||1==settings.pause)return;const allModels=this.attributeGet("allModels");Object.keys(allModels).forEach(id_str=>{allModels[id_str].updateView()})},mapBoundsChange:function(query){this.attributeGet("settings").pause||(this.updateViews(),this.fetchData(query))},fetchData:function(query){if(this.attributeGet("timeout"))return;this.attributeSet("timeout",!0);let params=this.attributeGet("params");params=Object.assign(params,query),this.attributeSet("params",params),this.fetch({data:params,processData:!0,remove:!0,success:this.dataLoaded.bind(this),error:(collection,response)=>{throw"ERROR FETCHING"}}),setTimeout(()=>{this.attributeSet("timeout",!1)},1e3)},dataLoaded:function(collection){const allModels=this.attributeGet("allModels"),settings=this.attributeGet("settings");collection.each(model=>{allModels[model.id_str]=model}),EventMediator.emit("collection-locations-loaded",{twitter:this.models});const trigger=!0!==settings.hide;this.attributeSet("newElements",this.models,trigger)},selectHover:function(id_str){const model=this.attributeGet("allModels")[id_str];EventMediator.emit("item-hover-request",model.get("latlng"))},mapClusterSelected:function(model){const settings=this.attributeGet("settings");!0===settings.hide||settings.pause||this.attributeSet("scrollTo",model,!0)}});return ItemCollection.prototype.attributeGet=function(attribute){return this.attributes||(this.attributes={}),this.attributes[attribute]},ItemCollection.prototype.attributeSet=function(attribute,value,trigger){if(this.attributes||(this.attributes={}),null===attribute||"object"!=typeof attribute){if("string"==typeof attribute)return this.attributes[attribute]=value,void(void 0!==trigger&&typeof trigger==typeof!0&&!0===trigger&&this.trigger(`change:${attribute}`))}else{let attributes=attribute;Object.keys(attributes).forEach(attr=>{this.attributes[attr]=attributes[attr]})}},ItemCollection.prototype.set=function(items){if(!0===this.attributeGet("settings").pause)return;const allModels=this.attributeGet("allModels");let newItems=_.reject(items,item=>void 0!==allModels[item.id_str]);return Backbone.Collection.prototype.set.call(this,newItems)},ItemCollection}),define("TweetCollection",["backbone","ItemModelTweet","ItemCollection","EventMediator"],function(Backbone,ItemModelTweet,ItemCollection,EventMediator){return ItemCollection.extend({model:ItemModelTweet,url:"/api/tweets",boundsQueryToString:function(bounds){return`${bounds.center.lat},${bounds.center.lng},${miles=bounds.dist,69*miles}mi`;var miles},initialize:function(models,options){this.attributeSet({bounds:options.bounds,timeout:!1,scrollTo:void 0,clusters:[],allModels:{},params:{geocode:this.boundsQueryToString(options.bounds)},settings:{hide:!1,pause:!1}}),this.fetchData(this.attributeGet("params"))},mapBoundsChange:function(data){this.attributeSet({bounds:data.bounds,clusters:data.clusters});const query={geocode:this.boundsQueryToString(data.bounds)},oldGeocode=this.attributeGet("params").geocode;query.geocode!==oldGeocode&&ItemCollection.prototype.mapBoundsChange.apply(this,[query])},clear:function(){ItemCollection.prototype.clear.apply(this),EventMediator.emit("twitter-cleared",null)},setSearchValue:function(searchValue){let params=this.attributeGet("params");params=Object.assign(params,{q:searchValue}),this.attributeSet("params",params)},showIds:function(ids){const allModels=this.attributeGet("allModels");ids.forEach(id=>{allModels[id].show()})}})}),define("EventMediator",["backbone"],function(Backbone){var events;return events={"twitter-clear":[],"collection-locations-loaded":[],"map-center-request":[],"item-hover-request":[],"map-model-assign-locations":[],"map-bounds-changed":[],"map-clear-all":[]},{listen:function(event,callback,obj){if(events[event]||(events[event]=[]),void 0===events[event])throw"Event Not Recognized: "+event;return events[event].push({callback:callback,obj:obj}),this},emit:function(event,data){return!!events[event]&&(events[event].forEach(subscription=>{void 0!==subscription.callback&&subscription.callback.apply(subscription.obj,[data])}),this)}}}),define("ClusterModel",["gmaps","markerclustererplus"],function(gmaps,markerclustererplus){return function(map,markers,events){let cluster=new MarkerClusterer(map,markers,{zoomOnClick:!1,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",minimumClusterSize:1});return void 0!==events&&events.forEach(item=>{google.maps.event.addListener(cluster,item.listen,clusterItem=>{item.callback.apply(item.context,[clusterItem])})}),MarkerClusterer.prototype.clear=function(){this.clearMarkers(),this.clusters_=[],this.repaint()},cluster}}),define("GeolocationModel",["backbone","gmaps"],function(Backbone,EventMediator,gmaps){return Backbone.Model.extend({defaults:{params:{},latlng:{},timeout:!1,geocoder:new google.maps.Geocoder},parseUserInput:function(input){let splitInput=input.split(",");return isNaN(parseInt(splitInput[0]))&&isNaN(parseInt(splitInput[1]))?void this.fetchData(input):void this.parseLatLngLocation(splitInput)},parseLatLngLocation:function(splitInput){let lat=parseFloat(splitInput[0]),lng=parseFloat(splitInput[1]);this.set("latlng",{lat:lat,lng:lng})},fetchData:function(query){this.get("timeout")||(this.set("timeout",!0),this.get("geocoder").geocode({address:query},this.geocodeDataLoad.bind(this)),setTimeout(()=>{this.set("timeout",!1)},1e3))},geocodeDataLoad:function(results,status){if(status===google.maps.GeocoderStatus.OK){let lat=results[0].geometry.location.lat(),lng=results[0].geometry.location.lng();this.set("latlng",{lat:lat,lng:lng})}else console.log("Geocode was not successful for the following reason: "+status)}})}),define("ItemModel",["backbone"],function(Backbone){return Backbone.Model.extend({show:function(){this.changeVisible(!0),this.updateView()},hide:function(){this.changeVisible(!1),this.updateView()},changeVisible:function(value){this.set("visible",value)},updateView:function(){this.trigger("change:update")},getLink:function(){throw"NEED TO IMPLMENT GET LINK"}})}),define("ItemModelInstagram",["backbone","ItemModel"],function(Backbone,ItemModel){return ItemModel.extend({defaults:{modelType:"instagram",selected:!1,visible:!1},initialize:function(data){this.set("latlng",{lat:data.lat,lng:data.lng}),this.id_str=data.id_str},getLink:function(){return this.get("node").thumbnail_src}})}),define("ItemModelTweet",["backbone","ItemModel"],function(Backbone,ItemModel){return ItemModel.extend({defaults:{modelType:"twitter",selected:!1,visible:!1},initialize:function(data){this.id_str=data.id_str},getLink:function(){return`https://twitter.com/${this.get("user").screen_name}/status/${this.get("id_str")}`}})}),define("MapModel",["backbone","underscore","EventMediator","ClusterModel","MarkerModel"],function(Backbone,_,EventMediator,ClusterModel,MarkerModel){var PARSE_LAT_LNG=function(num){return parseInt(1e4*num)/1e4};return Backbone.Model.extend({defaults:{selected:void 0,mapParams:{}},initialize:function(data){this.map=new google.maps.Map(data.mapELE,{zoom:16,center:new google.maps.LatLng(PARSE_LAT_LNG(data.bounds.center.lat),PARSE_LAT_LNG(data.bounds.center.lng)),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),this.clusters=new ClusterModel(this.map,[])},updateLocationMarker:function(latlng){this.clearCurrentLocationMarker();const markerParams={position:latlng,label:"",map:this.map};this.currentLocationMarker=new google.maps.Marker(markerParams)},clear:function(){this.clearCurrentLocationMarker(),this.clusters.clear()},clearCurrentLocationMarker:function(){void 0!==this.currentLocationMarker&&this.currentLocationMarker.setMap(null)},addLocations:function(locations){let subscriber,markers=[];for(subscriber in locations)markers=locations[subscriber].map(model=>new MarkerModel(model));this.clusters.addMarkers(markers)},updateSelectedCluster:function(cluster){let lat=cluster.center_.lat(),lng=cluster.center_.lng(),markers=cluster.markers_;markers.forEach(marker=>{marker.model.show()}),this.set("selected",markers[0].model),this.updateLocationMarker({lat:lat,lng:lng})},updateBounds:function(){let cluster,bounds=this.map.getBounds(),center=this.map.getCenter(),clusters=this.clusters.getClusters(),lat=center.lat(),lng=center.lng(),latf=bounds.f.b,lngb=bounds.b.b,distLat=Math.abs(lat-latf),distLng=Math.abs(lng-lngb),params={bounds:{center:{lat:lat,lng:lng},dist:Math.max(distLat,distLng)},clusters:clusters};for(cluster of clusters){let marker;for(marker of cluster.markers_)marker.model.changeVisible(!0)}this.set("mapParams",params)}})}),define("MarkerModel",["gmaps"],function(gmaps){return function(model){const latlng=model.get("latlng");var marker=new google.maps.Marker({position:{lat:latlng.lat,lng:latlng.lng},label:model.id_str});return marker.model=model,marker}}),define("PopupModel",["backbone","gmaps"],function(Backbone,gmaps){return Backbone.Model.extend({defaults:{markers:[],index:0,point:void 0,marker:void 0,previous:!1,next:!1},populate:function(cluster){this.set(this.defaults,{silent:!0});const point=this.fromLatLngToPoint(cluster.getCenter(),cluster.getMap()),markers=cluster.getMarkers(),next=markers.length>1;this.set({markers:markers,marker:markers[0],point:point,next:next})},next:function(){const markers=this.get("markers");let index=this.get("index"),next=!0;++index>=markers.length-1&&(next=!1),this.set({marker:markers[index],index:index,next:next,previous:!0})},previous:function(){const markers=this.get("markers");let index=this.get("index"),previous=!0;--index<=0&&(previous=!1),this.set({marker:markers[index],index:index,next:!0,previous:previous})},fromLatLngToPoint:function(latLng,map){let topRight=map.getProjection().fromLatLngToPoint(map.getBounds().getNorthEast()),bottomLeft=map.getProjection().fromLatLngToPoint(map.getBounds().getSouthWest()),scale=Math.pow(2,map.getZoom()),worldPoint=map.getProjection().fromLatLngToPoint(latLng);return new google.maps.Point((worldPoint.x-bottomLeft.x)*scale,(worldPoint.y-topRight.y)*scale)}})}),define("Router",["backbone","HomeView","EventMediator"],function(Backbone,HomeView,EventMediator){return Backbone.Router.extend({routes:{"location/:lat/:lng/:dist":"location"},initialize:function(options){this.homeView,this.homeViewHasRendered=!1,EventMediator.listen("map-bounds-changed",this.updateURL,this)},start:function(){this.homeViewHasRendered||(this.homeView=new HomeView({el:"#app-main",bounds:void 0}))},updateURL:function(data){let bounds=data.bounds,center=bounds.center,URLoptions=`location/${center.lat}/${center.lng}/${bounds.dist}`;this.navigate(URLoptions,{trigger:!1})},location:function(lat,lng,dist){this.homeViewHasRendered=!0;let bounds={center:{lat:parseFloat(lat),lng:parseFloat(lng)},dist:parseFloat(dist)};this.homeView=new HomeView({el:"#app-main",bounds:bounds})}})}),define(["backbone","HomeView","Router"],function(Backbone,HomeView,Router){return Backbone.View.extend({initialize:function(){var router=new Router;Backbone.history.start(),router.start()}})}),define("GeolocationView",["backbone","tpl!views/templates/geolocation_view.tpl","GeolocationModel","EventMediator"],function(Backbone,GeolocationViewTemplate,GeolocationModel,EventMediator){return Backbone.View.extend({events:{"click #map-button-search":"userLocationInput"},initialize:function(data){this.model=new GeolocationModel({}),this.html=GeolocationViewTemplate(),$(this.el).html(this.html),this.model.on("change:latlng",this.modelLocationLoaded.bind(this))},userLocationInput:function(e){let input=$("#map-search-text").val();this.model.parseUserInput(input),EventMediator.emit("map-clear-all")},modelLocationLoaded:function(model,value){EventMediator.emit("map-center-request",value)}})}),define("HomeView",["backbone","tpl!views/templates/home_view.tpl","SingletonView","MapView","PanelViewTwitter","PanelViewInstagram","GeolocationView"],function(Backbone,HomeViewTemplate,SingletonView,MapView,PanelViewTwitter,PanelViewInstagram,GeolocationView){return new SingletonView(Backbone.View.extend({initialize:function(options){this.html=HomeViewTemplate(),this.$el.html(this.html);const bounds=void 0!==options.bounds?options.bounds:{center:{lat:42.9634,lng:-85.6681},dist:.015};this.panelLeftView=new PanelViewTwitter({el:"#panel-twitter",bounds:bounds}),this.panelRightView=new PanelViewInstagram({el:"#panel-instagram",bounds:bounds});new GeolocationView({el:"#geolocation-view"});new MapView({el:"#map-view",bounds:bounds}).render()},render:function(){return this}}))}),define("InstagramView",["backbone","tpl!views/templates/instagram_view.tpl"],function(Backbone,InstagramViewTemplate){return Backbone.View.extend({initialize:function(data){this.model=data.model,this.el=data.el,this.template=InstagramViewTemplate;let link=this.model.getLink();this.html=this.template({link:link,id_str:this.model.id_str})},render:function(){$(this.el).append(this.html)}})}),define("MapView",["backbone","MapModel","gmaps","PopupView","EventMediator","tpl!views/templates/map_view.tpl"],function(Backbone,MapModel,gmaps,PopupView,EventMediator,MapViewTemplate){return Backbone.View.extend({events:{"click #map-button-search":"userLocationInput"},initialize:function(data){this.$el.html(MapViewTemplate()),$("#map-map").css({width:$(window).width(),height:$(window).height()}),this.model=new MapModel({bounds:data.bounds,mapELE:document.getElementById("map")}),this.clusterView=new PopupView({el:"#panel-cluster"}),this.model.on("change:mapParams",(model,params)=>{EventMediator.emit("map-bounds-changed",params)}),this.model.map.addListener("bounds_changed",this.clusterView.empty.bind(this.clusterView)),this.model.map.addListener("click",this.clusterView.empty.bind(this.clusterView)),google.maps.event.addListener(this.model.clusters,"clusterclick",clusterItem=>{this.clusterView.populate.apply(this.clusterView,[clusterItem]),this.model.updateSelectedCluster.apply(this.model,[clusterItem]);const model=clusterItem.getMarkers()[0].model;EventMediator.emit("map-cluster-selected",model)}),google.maps.event.addListener(this.model.clusters,"clusteringend",clusterItem=>{this.model.updateBounds.apply(this.model)}),EventMediator.listen("twitter-clear",this.clear,this),EventMediator.listen("map-center-request",this.model.map.setCenter,this.model.map),EventMediator.listen("collection-locations-loaded",this.model.addLocations,this.model),EventMediator.listen("item-hover-request",this.model.updateLocationMarker,this.model),EventMediator.listen("map-clear-all",this.clear,this)},clear:function(){this.model.clear()}})}),define("NavView",["backbone","underscore"],function(Backbone,_){return Backbone.View.extend({initialize:function(data){this.router=data.router;let template=_.template('\n        <ul>\n          <% _.each(Object.keys(routes), function(route){ %>\n              <li id="nav-<%= route %>" data-url="<%= route %>"><%= route %></li>\n          <% }); %>\n        </ul>\n      ');return this.$el.html(template({routes:this.router.routes})),this},events:{click:"onClick"},onClick:function(e){let $li=$(e.target);this.router.navigate($li.attr("data-url"),{trigger:!0})}})}),define("PanelHeadingView",["backbone","tpl!views/templates/panel_heading_view.tpl"],function(Backbone,PanelHeadingViewTemplate){return Backbone.View.extend({initialize:function(data){this.el=data.el,this.template=PanelHeadingViewTemplate,$(this.el).html(this.template({heading:data.heading,uniqueName:data.uniqueName}))},render:function(){return this}})}),define("PanelView",["backbone","PanelHeadingView","EventMediator","ScrollView","tpl!views/templates/panel_view.tpl"],function(Backbone,PanelHeadingView,EventMediator,ScrollView,PanelViewTemplate){return Backbone.View.extend({initialize:function(options){const titleId=`panel-${options.uniqueName}-title`,itemsId=`panel-${options.uniqueName}-items`;this.template=PanelViewTemplate,this.$el.html(this.template({titleId:titleId,itemsId:itemsId})),this.headingView=new PanelHeadingView({el:`#${titleId}`,heading:options.heading,uniqueName:options.uniqueName});const ScrollViewInit=new ScrollView(options.subView);this.scrollView=new ScrollViewInit({el:`#${itemsId}`,collection:this.collection}),this.collection.on("change:newElements",this.scrollView.render.bind(this.scrollView)),this.collection.on("change:scrollTo",this.scrollTo.bind(this)),EventMediator.listen("map-clear-all",this.clear,this),EventMediator.listen("map-bounds-changed",this.collection.mapBoundsChange,this.collection),EventMediator.listen("map-cluster-selected",this.collection.mapClusterSelected,this.collection)},scrollTo:function(){const scrollToModel=this.collection.attributeGet("scrollTo");void 0!==scrollToModel&&this.uniqueName===scrollToModel.get("modelType")&&$(`#panel-${this.uniqueName}-items`).animate({scrollTop:$(`#panel-${this.uniqueName}-items`).scrollTop()+$(`#${this.uniqueName}-${scrollToModel.id_str}`).position().top},1e3)},render:function(){return this.scrollView.render(),this},clear:function(){this.scrollView.clear(),this.collection.clear()},show:function(e){this.showPanel({hide:!1})},start:function(e){this.showPanel({pause:!1})},pause:function(e){const uniqueName=$(e.target).attr("data-url");this.hidePanel(`<button class="start-button" id="${uniqueName}-start" >Start</button>`,{pause:!0})},hide:function(e){const uniqueName=$(e.target).attr("data-url");this.hidePanel(`<button class="show-button" id="${uniqueName}-show" >Show</button>`,{hide:!0})},changeView:function(html,css,animation,callback,context,data){this.$el.animate(animation.begin,200,()=>{this.$el.html(html),this.$el.css(css),this.$el.animate(animation.end,200,()=>{void 0!==callback&&callback.call(context,data)})})}})}),define("PanelViewGram",["backbone","InstagramView","tpl!views/templates/panel_view_gram.tpl"],function(Backbone,InstagramView,PanelViewGramTemplate){return Backbone.View.extend({initialize:function(data){this.model=data.model,InstagramView.prototype.initialize.apply(this,[data]),this.el=data.el,this.visible=!1,this.superTemplate=PanelViewGramTemplate,this.html=this.superTemplate({id_str:this.model.id_str,instagramHtml:this.html,latlng:JSON.stringify(this.model.get("latlng"))}),this.elementId=`#instagram-${this.model.id_str}`,this.model.on("change:selected",this.selected.bind(this)),this.model.on("change:update",this.updateView.bind(this)),this.updateView()},selected:function(){$(this.elementId).removeClass("tweet-container-selected"),this.model.get("selected")&&$(this.elementId).addClass("tweet-container-selected")},updateView:function(){const modelVisible=this.model.get("visible");this.model.set("visible",!1),!0!==this.visible||!0!==modelVisible?!0===modelVisible?(this.visible=!0,$(this.el).append(this.html)):($(this.elementId).remove(),this.visible=!1):this.model.set("visible",!1)}})}),define("PanelViewInstagram",["backbone","PanelView","PanelViewGram","InstagramCollection","SingletonView","EventMediator","tpl!views/templates/panel_view_instagram.tpl"],function(Backbone,PanelView,PanelViewGram,InstagramCollection,SingletonView,EventMediator,PanelViewInstagramTemplate){return new SingletonView(PanelView.extend({events:{"mouseenter .instagram-container":"mouseHover","click #instagram-hide":"hide","click #instagram-show":"show","click #instagram-pause":"pause","click #instagram-start":"start"},initialize:function(options){this.collection=new InstagramCollection(null,{bounds:options.bounds}),options.uniqueName="instagram",options.subView=PanelViewGram,options.heading=PanelViewInstagramTemplate(),PanelView.prototype.initialize.apply(this,[options])},mouseHover:function(e){e.preventDefault();let id_str=$(e.currentTarget).attr("data-url");this.collection.selectHover(id_str)},showPanel:function(settings){this.collection.setSettings(settings);let html=this.holdHtml;this.changeView(html,{height:"95%",width:"330px"},{begin:{right:"-=500"},end:{right:"+=500"}})},hidePanel:function(newHtml,settings){this.holdHtml=$(this.el).html(),this.collection.setSettings(settings);this.changeView(newHtml,{height:"auto",width:"auto"},{begin:{right:"-=500"},end:{right:"+=500"}})}}))}),define("PanelViewTweet",["backbone","TweetView","EventMediator","tpl!views/templates/panel_view_tweet.tpl"],function(Backbone,TweetView,EventMediator,PanelViewTweetTemplate){return Backbone.View.extend({initialize:function(data){this.model=data.model,TweetView.prototype.initialize.apply(this,[data]),this.el=data.el,this.visible=!1,this.updating=!1,this.elementId=`#twitter-${this.model.id_str}`,this.superTemplate=PanelViewTweetTemplate,this.html=this.superTemplate({id_str:this.model.id_str,tweetHtml:this.html,latlng:JSON.stringify(this.model.get("latlng"))}),this.model.on("change:selected",this.selected.bind(this)),this.model.on("change:update",this.updateView.bind(this)),this.updateView()},selected:function(){$(this.elementId).removeClass("tweet-container-selected"),this.model.get("selected")&&$(this.elementId).addClass("tweet-container-selected")},updateView:function(){const modelVisible=this.model.get("visible");this.model.set("visible",!1),!0!==this.visible||!0!==modelVisible?!0===modelVisible?(this.visible=!0,$(this.el).append(this.html)):($(this.elementId).remove(),this.visible=!1):this.model.set("visible",!1)}})}),define("PanelViewTwitter",["backbone","tpl!views/templates/panel_view_twitter.tpl","PanelView","PanelViewTweet","TweetCollection","SingletonView","EventMediator"],function(Backbone,PanelViewTwitterTemplate,PanelView,PanelViewTweet,TweetCollection,SingletonView,EventMediator){return new SingletonView(PanelView.extend({events:{"click .button-go-to-tweet-location":"tweetLocationRequest","mouseenter .tweet-container":"tweetMouseHover","click #tweet-search-submit":"tweetSearch","click #twitter-hide":"hide","click #twitter-show":"show","click #twitter-pause":"pause","click #twitter-start":"start"},initialize:function(options){this.collection=new TweetCollection(null,{bounds:options.bounds}),this.removedIds=[],options.uniqueName="twitter",options.subView=PanelViewTweet,options.heading=PanelViewTwitterTemplate(),PanelView.prototype.initialize.apply(this,[options])},showPanel:function(settings){this.collection.setSettings(settings);this.changeView(this.holdHtml,{height:"95%",width:"330px"},{begin:{left:"-=500"},end:{left:"+=500"}},this.collection.showIds,this.collection,this.removedIds)},hidePanel:function(newHtml,settings){this.collectVisibleTweetIds(),this.collection.setSettings(settings),this.holdHtml=$(this.el).html();this.changeView(newHtml,{height:"auto",width:"auto"},{begin:{left:"-=500"},end:{left:"+=500"}})},collectVisibleTweetIds:function(){this.removedIds=[];let elementArray=$(this.el).find(".tweet-container");elementArray.each(index=>{let element=elementArray[index];this.removedIds.push($(element).attr("data-url"))})},tweetLocationRequest:function(e){e.preventDefault();let latlng=$(e.target).attr("data-url");EventMediator.emit("map-center-request",JSON.parse(latlng))},tweetSearch:function(e){e.preventDefault();let searchValue=$("#tweet-search-text").val();this.collection.setSearchValue(searchValue),this.clear()},tweetMouseHover:function(e){e.preventDefault();let id_str=$(e.currentTarget).attr("data-url");this.collection.selectHover(id_str)}}))}),define("PopupView",["backbone","tpl!views/templates/popup_view.tpl","PopupModel","TweetView","InstagramView"],function(Backbone,PopupViewTemplate,PopupModel,TweetView,InstagramView){var VIEW_TYPES={twitter:TweetView,instagram:InstagramView};return Backbone.View.extend({events:{"click #holder-title-previous":"previous","click #holder-title-next":"next"},initialize:function(data){this.subElement="#holder-map-items",this.model=new PopupModel({}),this.model.on("change:marker",this.render,this)},render:function(){this.$el.html(PopupViewTemplate()),$(this.subElement).empty();const point=this.model.get("point"),previous=this.model.get("previous"),next=this.model.get("next");!0===(!previous&&!next)&&$("#holder-map-title").empty(),$("#holder-title-previous").prop("disabled",!previous),$("#holder-title-next").prop("disabled",!next),this.$el.css({left:point.x,top:point.y}),this.addItem(),this.$el.css({visibility:"visible"}),this.$el.css({"max-height":"calc(100% - "+point.y+"px)"}),$(this.subElement).css({"max-height":"calc(100% - "+point.y+"px)"})},addItem:function(model){const itemModel=this.model.get("marker").model;let modelType=itemModel.get("modelType");new(0,VIEW_TYPES[modelType])({el:this.subElement,model:itemModel}).render()},empty:function(){this.$el.css({visibility:"hidden"}),$(this.subElement).empty()},populate:function(cluster){this.model.populate(cluster)},next:function(){this.model.next()},previous:function(){this.model.previous()}})}),define("ScrollView",["backbone"],function(Backbone){return function(viewObj){return Backbone.View.extend({initialize:function(data){this.collection=data.collection,this.el=data.el},clear:function(){$(this.el).empty()},render:function(){return this.collection.each(model=>{new viewObj({el:this.el,model:model})}),this}})}}),define("SingletonView",["backbone"],function(Backbone){return function(obj){var instance=void 0;return function(params){return void 0===instance&&(instance=new obj(params)),instance}}}),define("TweetView",["backbone","tpl!views/templates/tweet_view.tpl"],function(Backbone,TweetViewTemplate){return Backbone.View.extend({initialize:function(data){this.model=data.model,this.el=data.el,this.template=TweetViewTemplate;let link=this.model.getLink();this.html=this.template({link:link})},render:function(){$(this.el).append(this.html)}})});